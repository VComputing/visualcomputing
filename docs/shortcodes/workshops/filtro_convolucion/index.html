<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content=" Filtros de Convolución # "><meta name=theme-color content="#FFFFFF"><meta name=color-scheme content="light dark"><meta property="og:title" content><meta property="og:description" content=" Filtros de Convolución # "><meta property="og:type" content="article"><meta property="og:url" content="https://VComputing.github.io/visualcomputing/docs/shortcodes/workshops/filtro_convolucion/"><meta property="article:section" content="docs"><meta property="article:modified_time" content="2022-09-08T00:54:17-05:00"><title>Filtro Convolucion | Showcase Template</title><link rel=manifest href=/visualcomputing/manifest.json><link rel=icon href=/visualcomputing/favicon.png type=image/x-icon><link rel=stylesheet href=/visualcomputing/book.min.ab46de3e725a6415339a37bba23a0067534a37289b063c9f8d011515a63097a8.css integrity="sha256-q0bePnJaZBUzmje7ojoAZ1NKNyibBjyfjQEVFaYwl6g=" crossorigin=anonymous><script defer src=/visualcomputing/flexsearch.min.js></script>
<script defer src=/visualcomputing/en.search.min.4d321351e65771b2e4837670a079f65d61c7b97cf4578a831cc454ae8afeee73.js integrity="sha256-TTITUeZXcbLkg3ZwoHn2XWHHuXz0V4qDHMRUror+7nM=" crossorigin=anonymous></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/visualcomputing/><span>Showcase Template</span></a></h2><div class=book-search><input type=text id=book-search-input placeholder=Search aria-label=Search maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><ul><li class=book-section-flat><span>Shortcodes</span><ul><li><input type=checkbox id=section-230b36e4e57db4445794a5bbb4157fd2 class=toggle checked>
<label for=section-230b36e4e57db4445794a5bbb4157fd2 class="flex justify-between"><a href=/visualcomputing/docs/shortcodes/workshops/>Workshops</a></label><ul><li><a href=/visualcomputing/docs/shortcodes/workshops/filtro_convolucion/ class=active>Filtro Convolucion</a></li><li><a href=/visualcomputing/docs/shortcodes/workshops/visual_illusions/>Visual Illusions</a></li></ul></li></ul></li></ul><ul><li><a href=/visualcomputing/posts/>Blog</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/visualcomputing/svg/menu.svg class=book-icon alt=Menu></label>
<strong>Filtro Convolucion</strong>
<label for=toc-control><img src=/visualcomputing/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#filtros-de-convolución>Filtros de Convolución</a></li></ul></nav></aside></header><article class=markdown><h1 id=filtros-de-convolución>Filtros de Convolución
<a class=anchor href=#filtros-de-convoluci%c3%b3n>#</a></h1><iframe style=width:625px;height:625px srcdoc='
        <!DOCTYPE html>
        <html>
          <head>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/p5.min.js></script>
            <script src=https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.2/addons/p5.sound.min.js></script>
            
            
            
            
            
            <script>
              

var pictures;
let img;
let c;

const kernels = [
  //Identidad
  [[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], 
   [[0, 0, 0, 0], [1, 1, 1, 1], [0, 0, 0, 0]],
   [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]],
  //Desenfoque (media)
  [[[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]], 
   [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]],
   [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]]],
  //Enfoque
  [[[0, 0, 0, 0], [-1, -1, -1, -1], [0, 0, 0, 0]], 
   [[-1, -1, -1, -1], [5, 5, 5, 5], [-1, -1, -1, -1]],
   [[0, 0, 0, 0], [-1, -1, -1, -1], [0, 0, 0, 0]]],
  //Media ponderada para no perder detalle
  [[[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]], 
   [[1, 1, 1, 1], [2, 2, 2, 2], [1, 1, 1, 1]],
   [[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]]],
  //Realzar bordes
  [[[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]], 
   [[1, 1, 1, 1], [-1, -1, -1, -1], [0, 0, 0, 0]],
   [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]]],
  //Detectar bordes
  [[[0, 0, 0, 0], [1, 1, 1, 1], [0, 0, 0, 0]], 
   [[1, 1, 1, 1], [-1, -1, -1, -1], [1, 1, 1, 1]],
   [[0, 0, 0, 0], [1, 1, 1, 1], [0, 0, 0, 0]]], 
  //Repujado
  [[[-2, -2, -2, -2], [-1, -1, -1, -1], [0, 0, 0, 0]], 
   [[-1, -1, -1, -1], [1, 1, 1, 1], [1, 1, 1, 1]],
   [[0, 0, 0, 0], [1, 1, 1, 1], [2, 2, 2, 2]]], 
  
  //DIRECCIONALES
  //Norte
  [[[1, 1, 1, 1], [1, 1, 1, 1], [1, 1, 1, 1]], 
   [[1, 1, 1, 1], [-2, -2, -2, -2], [1, 1, 1, 1]],
   [[-1, -1, -1, -1], [-1, -1, -1, -1], [-1, -1, -1, -1]]],
  //Este
  [[[-1, -1, -1, -1], [1, 1, 1, 1], [1, 1, 1, 1]], 
   [[-1, -1, -1, -1], [-2, -2, -2, -2], [1, 1, 1, 1]],
   [[-1, -1, -1, -1], [1, 1, 1, 1], [1, 1, 1, 1]]], 
  
  //Sobel
  //C 
  [[[-1, -1, -1, -1], [0, 0, 0, 0], [1, 1, 1, 1]], 
   [[-2, -2, -2, -2], [0, 0, 0, 0], [2, 2, 2, 2]],
   [[-1, -1, -1, -1], [0, 0, 0, 0], [1, 1, 1, 1]]],
  //F
  [[[-1, -1, -1, -1], [-2, -2, -2, -2], [-1, -1, -1, -1]], 
   [[0, 0, 0, 0], [0, 0, 0, 0], [0, 0, 0, 0]],
   [[1, 1, 1, 1], [2, 2, 2, 2], [1, 1, 1, 1]]]
  
]

function preload() {
  //Aqui se carga una lista de imagenes
  pictures = new Array();
  
  pictures.push(loadImage(&#39;imgs/image0.jpg&#39;));
  
  pictures.push(loadImage(&#39;imgs/image1.jpg&#39;));
  pictures.push(loadImage(&#39;imgs/image2.jpg&#39;));
  pictures.push(loadImage(&#39;imgs/image3.jpg&#39;));
  pictures.push(loadImage(&#39;imgs/image4.jpg&#39;));
  
  }


function setup() {
  createCanvas(600, 600);
  colorMode(RGB);
  //background(0);
  pixelDensity();
  
}

function imagen(a, b){
  r = createImage(a, b);
  r.loadPixels();
  for (let i = 0; i < a; i++){
    for (let j = 0; j < b; j++){
      r.set(i, j, color(i * 255 / a, j * 255 / b, (i + j) *255 /(a + b) ));
    }
  }
  r.updatePixels();
  return r;
}

function seePixels(img, pars){
  img.loadPixels();
  let s = "";
  for (let i = 0; i < img.height; i++){
    for (let j = 0; j < img.width; j++){
      let idx = (i * img.width + j) * pars;
      for (let k = 0; k < pars; k++){
        s = s + " " + img.pixels[idx + k];
      }
      s = s + "\t";
    }
    s = s + "\n"
  }
  return s;
}

function seeMatrix(m){
  let s = "";
  for (let i = 0; i < m.length; i++){
    for (let j = 0; j < m[0].length; j++){
      s = s + "\t" + m[i][j];
    }
    s = s + "\n";
  }
  return s;
}

function img2matrix(img, pars){
  let w = img.width;
  let h = img.height;
  img.loadPixels();
  let t = img.pixels;
  let m = new Array();
  
  for (let i = 0; i < h; i++){
    m.push(new Array());
  }
  
  for (let i = 0; i < h; i++){
    for (let j = 0; j < w; j++){
      let idx = (i * w + j) * pars;
      m[i][j] = [];
      for (let k = 0; k < pars; k++){
        m[i][j].push(t[idx + k]);  
      }
    
    }
  }
  //print(seeMatrix(m));
  return m;
}

function vToroidales(m, i, j){
  let toro = new Array();
  let iLBorder = i % m.length === 0; 
  let iRBorder = (i + 1) % m.length === 0;
  let jUBorder = j % m[0].length === 0;
  let jDBorder = (j + 1) % m[0].length === 0;
  
  let iBack = iLBorder ? 0: 1;
  let iFront = iRBorder ? 1: 2;
  let jUp = jUBorder ? 0: 1;
  let jDown = jDBorder ? 1: 2;
  
  let i0 = i - iBack;
  let i1 = i + iFront;
  let j0 = j - jUp;
  let j1 = j + jDown;
  
  for (let k = 0; k < i1 - i0; k++){
    toro[k] = new Array();
  }
  
  let delta = j1 - j0;
  for (let a = 0; a < toro.length; a++){
    let jd = j0;
    for (let b = 0; b < delta; b++){
      toro[a][b] = m[i0][jd];
      jd++;
    }
    i0++;
  }
  return toro;
}



function convolution(m, ker, pars, f, off){
  let s = [];
  for (let k = 0; k < pars; k++){
    s.push(0);
    for (let i = 0; i < m.length; i++){
      for (let j = 0; j < m[0].length; j++){
        //s[k] = k < 3 ? s[k] + m[i][j][k] * ker[i][j][k]: m[i][j][k];
       s[k] = s[k] + m[i][j][k] * ker[i][j][k]; 
        
      }
    }
    
    s[k] = s[k] / f + off;
    s[k] = s[k] > 255 ? 255: s[k];
    s[k] = s[k] < 0? 0: s[k];
    
  }
  return s;
}

function transform(m, ker, pars, f, off){
  let mFinal = new Array();
  let kul = vToroidales(ker, 2, 2);
  let kuc = vToroidales(ker, 2, 1);
  let kur = vToroidales(ker, 2, 0);
  let kcl = vToroidales(ker, 1, 2);
  let kcr = vToroidales(ker, 1, 0);
  let kdl = vToroidales(ker, 0, 2);
  let kdc = vToroidales(ker, 0, 1);
  let kdr = vToroidales(ker, 0, 0);
  
  for (let i = 0; i < m.length; i++){
    mFinal.push(new Array());
    for (let j = 0; j < m[0].length; j++){
      let val;
      if (i === 0 && j === 0){
        val = kul;
      } else if (i === 0 && j < m[0].length - 1){
        val = kuc;
      } else if (i === 0 && j === m[0].length - 1){
        val = kur;
      } else if (i < m.length - 1 && j === 0){
        val = kcl;
      } else if (i < m.length - 1 && j === m[0].length - 1){
        val = kcr;
      } else if (i === m.length - 1 && j === 0){
        val = kdl;
      } else if (i === m.length - 1 && j < m[0].length - 1){
        val = kdc;
      } else if (i === m.length - 1 && j === m[0].length - 1){
        val = kdr;
      } else {
        val = ker;
      }
      
      
      
      mFinal[i][j] = convolution(vToroidales(m, i, j), val, pars, f, off);
      
    }
    
  }
  return mFinal;
}


function matrix2img(m, pars){
  let im = createImage(m[0].length, m.length);
  im.loadPixels();
  for (let i = 0; i < im.height; i++){
    for (let j = 0; j < im.width; j++){
      let idx = (i * im.width + j) * pars;
      for (let k = 0; k < pars; k++){
        im.pixels[idx + k] = m[i][j][k]; 
      }
      
    }
  }
  im.updatePixels();
  return im;
}

function applyFilter(im, pars, kernel, f, off, times){
  let pic = createImage(im.width, im.height);
  
  for (let i = 0; i < times; i++){
    let m = img2matrix(im, pars);
    let t = transform(m, kernel, pars, f, off);
    im = matrix2img(t, pars);
  }
  return im;
}

function histogramData(im){
  let hists = new Array();
  for (let i = 0; i < 5; i++){
    hists[i] = new Array(100);
    for (let j = 0; j < 100; j++){
      hists[i][j] = 0;
    }
  }
  
  let m = img2matrix(im, 4);
  for (let i = 0; i < m.length; i++){
    for (let j = 0; j < m[0].length; j++){
      let ba = lightness(color(m[i][j]));
      hists[0][parseInt(ba)]++;
      for (let k = 0; k < 4; k++){
        let bc = lightness(color(m[i][j][k]));
        hists[k + 1][parseInt(bc)]++;
      }
    }
  }
  return hists;
}

function histogram(im, x, y){
  fill(0);
  stroke(255);
  square(x, y, width / 2);
  
  let data = histogramData(im);
  let mgnx = x + 10;
  let mgny = height - 10;
  let factor = 2 * height;
  let st = height / 4;
  
  line(x, y + st, x + width / 2, y + st);
  
  for (let i = 0; i < data[0].length; i++){
    let h = mgny - st - data[0][i] / factor;
    line(mgnx + i, mgny - st, mgnx + i, h > y ? h: y + 10);
  }
  let base = 155;
  for (let k = 1; k < 4; k++){
    let d = data[k];
    let c = [0, 0, 0, 155];
    for (let i = 0; i < d.length; i++){
      let h = mgny - data[k][i] / factor;
      c[k - 1] = base + i;
      line(mgnx + i, mgny, mgnx + i, h > y + st? h: y + st + 5);
      stroke(color(c));
    }
  }
}

var filt = 0;
var bri = 0;
var fac = 1;
var im = 0;
var img2;
function draw() {
  //noLoop();
  
  background(0);
  img = pictures[im];
  img2 = applyFilter(img, 4, kernels[filt], fac, bri, 1);
  
  image(img, 0, 0, width / 2, height / 2);
  image(img2, width / 2, 0, width / 2, height / 2);
  histogram(img, 0, height / 2);
  histogram(img2, width / 2, height / 2);
  
}

function keyPressed(){
  if (keyCode === RIGHT_ARROW){
    filt++;
  } else if (keyCode === LEFT_ARROW){
    filt--;
  } else if (keyCode === UP_ARROW){
    fac++;
    fac = fac === 0 ? 1: fac;
  } else if (keyCode === DOWN_ARROW){
    fac--;
    fac = fac === 0 ? -1: fac; 
  } else if (keyCode === 87){
    bri++;
  } else if (keyCode === 83){
    bri--;
  } else if (keyCode === 65){
    im--;
    if (im < 0){
        im = pictures.length - 1;
    }
  } else if (keyCode === 68){
    im++;
  } else if (keyCode === 82){
    filt = 0;
    bri = 0;
    fac = 1;
    im = 0;
  } else if (keyCode === ENTER){
    pictures.push(img2);
  }
  
  filt = filt % kernels.length;
  bri = bri >= 255 ? 250: bri;
  bri = bri <= -255 ? - 250: bri;
  im = im % pictures.length;  
  print(keyCode);
}


            </script>
          </head>
          <body>
          </body>
        </html>
      '></iframe></article><footer class=book-footer><div class="flex flex-wrap justify-between"><div><a class="flex align-center" href=https://github.com/VComputing/visualcomputing/commit/16aa3ecfe9c97808f592616aebd93f85680c0a37 title='Last modified by Diego Fernando Bulla Poveda | September 8, 2022' target=_blank rel=noopener><img src=/visualcomputing/svg/calendar.svg class=book-icon alt=Calendar>
<span>September 8, 2022</span></a></div></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#filtros-de-convolución>Filtros de Convolución</a></li></ul></nav></div></aside></main></body></html>